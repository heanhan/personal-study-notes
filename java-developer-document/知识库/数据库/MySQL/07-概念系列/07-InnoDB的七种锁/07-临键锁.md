# 临键锁(Next-key Locks)

临键锁，是记录锁与间隙锁的组合，它的封锁范围，既包含索引记录，又包含索引区间。

更具体的，临键锁会封锁索引记录本身，以及索引记录之前的区间。

如果一个会话占有了索引记录R的共享/排它锁，其他会话不能立刻在R之前的区间插入新的索引记录。

依然是上面的例子，InnoDB，RR：

```
t(id PK, name KEY, sex, flag);
```

表中有四条记录：

```
1, shenjian, m, A
3, zhangsan, m, A
5, lisi, m, A
9, wangwu, f, B
```

PK上潜在的临键锁为：

```
(-infinity, 1]
(1, 3]
(3, 5]
(5, 9]
(9, +infinity)
```

临键锁的主要目的，也是为了避免幻读(Phantom Read)。如果把事务的隔离级别降级为RC，临键锁则也会失效。

