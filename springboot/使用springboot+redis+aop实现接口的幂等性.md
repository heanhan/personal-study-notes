### SpringBoot自定义注解+AOP+redis实现防接口幂等性重复提交

> 本次解决是对于高并发不高的情况，适用于一般的管理系统，给出的解决方案！！高并发的还是建议加分布式锁！！

#### 什么是幂等性？

接口幂等性就是用户对于`同一操作`发起的`一次请求或者多次请求`的结果是`一致的`，不会因 为多次点击而产生了副作用。

#### Rest风格与幂等性

支持幂等性的是GET、PUT、DELETE。

不知幂等性的：POST。

所以我们要解决的就是POST请求。

#### 解决思路

##### 大概主流的解决方案：

- token机制（前端带着在请求头上带着标识，后端验证）
- 加锁机制
  - 数据库悲观锁（锁表）
  - 数据库乐观锁（version号进行控制）
  - 业务层分布式锁（加分布式锁redisson）
- 全局唯一索引机制
- redis的set机制
- 前端按钮加限制

本文解决方案就是redis的set机制！

同一个用户，任何POST保存相关的接口，1s内只能提交一次。

完全使用后端来进行控制，前端可以加限制，不过体验不好！

后端通过自定义注解，在需要防幂等接口上添加注解，利用AOP切片，减少和业务的耦合！ 在切片中获取用户的`token、user_id、url`构成redis的唯一key！ 第一次请求会先判断key是否存在，如果不存在，则往redis添加一个主键key，设置过期时间；

如果有异常会主动删除key，万一没有删除失败，等待1s，redis也会自动删除，时间误差是可以接受的！ 第二个请求过来，先判断key是否存在，如果存在，则是重复提交，返回保存信息！

