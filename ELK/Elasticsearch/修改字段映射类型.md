### Elasitcsearch 修改字段映射类型

之前在没有创建索引模板的时候，直接通过logstash往es里塞数据，其中一些字段的类型并不符合我们需要，这个时候就需要去修改字段的映射类型了。

es不支持直接修改字段类型，解决思路：

1. 新建临时索引，执行字段类型，复制数据
2. 删除旧索引，重建同名索引，从临时索引复制数据

```
# 暂停索引更新
PUT /my-index/_settings
{
"index.blocks.write": true
}

# 恢复索引更新
PUT /my-index/_settings
{
"index.blocks.write": false
}

#获取旧索引的字段映射
GET /users/_mapping

#创建临时索引带映射
PUT /users_temp
{
    "mappings": {
		"user": {
			"properties": {
				"age": {
					"type": "long"
                },
            }
        }
    }
}

#复制数据
POST /_reindex
{
  "source": {
    "index": "users"
  }, 
  "dest": {
    "index": "users_temp"
  }
}

#删除旧索引
DELETE /users

#创建新索引带映射
PUT /users
{
    "mappings": {
		"user": {
			"properties": {
				"age": {
					"type": "long"
                },
            }
        }
    }
}

#复制数据
POST /_reindex
{
  "source": {
    "index": "users_temp",
    "query": {
      "match_all": {}
    }
  }, 
  "dest": {
    "index": "users"
  }
}

#删除临时索引
DELETE /users_temp

```

